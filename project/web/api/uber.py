import os
import requests
import json

def get_environ_value(key):
    try:
        value = os.environ[key]
    except KeyError:
         raise KeyError,'Please check your enviroment variable'
    return value


def get_price(s_latitude,s_longitude,end_latitude,end_longitude):
    url = 'https://api.uber.com/v1/estimates/price'

    parameters = {
        'server_token': get_environ_value('UBER_KEY'),
        'start_latitude':s_latitude ,
        'start_longitude':s_longitude,
        'end_latitude': end_latitude,
        'end_longitude':end_longitude,
        
    }

    response = requests.get(url, params=parameters)
    data = json.loads(response.text)
    result = []
    for record in data['prices']:
        if 'Metered' not in record['estimate']:
            try:
                result.append((record['display_name'],record['distance'],get_fare(record['low_estimate'])))
            except:
                print 'error',record
    return result

def get_fare(price):
    #sample price range $1-$10
    #assume tip 20%
#    print price_range.split('-')
    fare = price * (5/6.0)
    return '$%.2f'%fare


if __name__ =='__main__':
    data = [[(u'-73.95', u'40.78', u'-73.95', u'40.77'), 5.592004612723429], [(u'-74.00', u'40.73', u'-74.00', u'40.73'), 5.778889527862442], [(u'-73.97', u'40.76', u'-73.98', u'40.76'), 6.058221009841677], [(u'-73.98', u'40.75', u'-73.99', u'40.75'), 6.065699821095505], [(u'-73.96', u'40.75', u'-73.97', u'40.75'), 5.8792694276407635], [(u'-73.97', u'40.75', u'-73.99', u'40.74'), 8.815896570549407], [(u'-73.96', u'40.76', u'-73.96', u'40.77'), 5.503378138847858], [(u'-73.96', u'40.76', u'-73.97', u'40.76'), 6.2382370026139995], [(u'-73.97', u'40.75', u'-73.97', u'40.76'), 6.182412031942211], [(u'-73.97', u'40.75', u'-73.96', u'40.75'), 5.758890551271723], [(u'-73.98', u'40.74', u'-73.97', u'40.74'), 5.765149426554919], [(u'-73.99', u'40.74', u'-73.98', u'40.73'), 6.8505698469553895], [(u'-73.98', u'40.75', u'-73.98', u'40.74'), 6.664236900341322], [(u'-73.97', u'40.75', u'-73.98', u'40.73'), 8.192934753423431], [(u'-73.98', u'40.76', u'-73.97', u'40.76'), 5.91992422554045], [(u'-73.97', u'40.78', u'-73.98', u'40.77'), 6.036137440758294], [(u'-73.98', u'40.73', u'-73.98', u'40.73'), 5.7174184435939495], [(u'-74.00', u'40.73', u'-73.99', u'40.73'), 5.813260748185371], [(u'-73.97', u'40.74', u'-73.97', u'40.75'), 6.19048892912997], [(u'-73.95', u'40.77', u'-73.97', u'40.75'), 9.854825488588808], [(u'-73.95', u'40.77', u'-73.95', u'40.78'), 5.311506524317912], [(u'-73.98', u'40.74', u'-73.98', u'40.75'), 6.868084781945715], [(u'-73.97', u'40.75', u'-73.98', u'40.74'), 6.708787958459314], [(u'-73.99', u'40.73', u'-73.99', u'40.74'), 6.068649885583524], [(u'-73.96', u'40.76', u'-73.97', u'40.75'), 6.669270967409772], [(u'-73.97', u'40.76', u'-73.96', u'40.76'), 5.850509187513836], [(u'-73.97', u'40.75', u'-73.97', u'40.75'), 6.12996197718631], [(u'-73.97', u'40.75', u'-73.96', u'40.76'), 6.499792258153867], [(u'-73.98', u'40.76', u'-73.98', u'40.77'), 6.182894117647058], [(u'-73.98', u'40.73', u'-73.99', u'40.72'), 6.773276308968377], [(u'-73.96', u'40.76', u'-73.95', u'40.77'), 5.961243079608367], [(u'-73.99', u'40.73', u'-73.99', u'40.73'), 5.929040986070749], [(u'-73.97', u'40.76', u'-73.97', u'40.75'), 6.136035980531083], [(u'-74.00', u'40.73', u'-73.99', u'40.74'), 6.183005874012558], [(u'-73.99', u'40.75', u'-73.97', u'40.76'), 8.827516059957173], [(u'-73.98', u'40.73', u'-73.97', u'40.74'), 6.182137129109863], [(u'-73.98', u'40.75', u'-73.97', u'40.75'), 6.547177319757389], [(u'-73.99', u'40.74', u'-73.99', u'40.73'), 6.006716610694911], [(u'-74.00', u'40.74', u'-73.99', u'40.74'), 5.674584255633123], [(u'-73.98', u'40.74', u'-73.99', u'40.75'), 7.210802625458681], [(u'-73.98', u'40.74', u'-73.98', u'40.76'), 9.219261946601666], [(u'-73.97', u'40.76', u'-73.98', u'40.75'), 7.083247175245551], [(u'-73.99', u'40.73', u'-74.00', u'40.73'), 5.819013899816418], [(u'-73.98', u'40.76', u'-73.99', u'40.75'), 6.690645314729665], [(u'-73.98', u'40.73', u'-73.98', u'40.72'), 6.624139250191278], [(u'-73.99', u'40.73', u'-73.98', u'40.74'), 7.042858621403437], [(u'-73.97', u'40.75', u'-73.98', u'40.75'), 6.6137315478193965], [(u'-73.99', u'40.74', u'-73.97', u'40.75'), 8.781913250672902], [(u'-73.96', u'40.76', u'-73.95', u'40.78'), 7.566380415278134], [(u'-73.98', u'40.76', u'-73.97', u'40.75'), 7.352923777692331], [(u'-73.98', u'40.77', u'-73.98', u'40.77'), 5.478934471670917], [(u'-73.99', u'40.75', u'-73.97', u'40.75'), 8.338778107764107], [(u'-73.96', u'40.77', u'-73.96', u'40.76'), 5.887668743509865], [(u'-73.98', u'40.77', u'-73.97', u'40.78'), 5.781389881086946], [(u'-73.98', u'40.73', u'-73.97', u'40.75'), 8.227133733307529], [(u'-73.97', u'40.75', u'-73.97', u'40.74'), 5.958372034112978], [(u'-73.99', u'40.74', u'-73.98', u'40.75'), 7.040006137087185], [(u'-73.99', u'40.72', u'-73.98', u'40.73'), 6.327186261558785], [(u'-73.96', u'40.76', u'-73.95', u'40.76'), 5.744056151450744], [(u'-73.99', u'40.74', u'-73.99', u'40.74'), 5.804913964861438], [(u'-73.95', u'40.77', u'-73.95', u'40.77'), 5.093256134546457], [(u'-73.98', u'40.74', u'-73.99', u'40.74'), 6.0738470761852055], [(u'-73.99', u'40.73', u'-73.99', u'40.72'), 6.38602977181471], [(u'-73.99', u'40.75', u'-73.98', u'40.74'), 7.372333564837781], [(u'-73.97', u'40.76', u'-73.98', u'40.74'), 8.414134132101335], [(u'-73.97', u'40.75', u'-73.95', u'40.77'), 9.03772015864216], [(u'-73.99', u'40.75', u'-73.99', u'40.75'), 6.322270295857989], [(u'-73.98', u'40.74', u'-73.99', u'40.73'), 6.191070817653096], [(u'-73.98', u'40.74', u'-73.97', u'40.76'), 8.435540069686411], [(u'-73.97', u'40.75', u'-73.98', u'40.76'), 7.612396784006953], [(u'-73.98', u'40.75', u'-73.98', u'40.76'), 6.231975813622621], [(u'-73.98', u'40.75', u'-73.97', u'40.76'), 6.6757583256734785], [(u'-73.97', u'40.74', u'-73.98', u'40.74'), 6.112373843566022], [(u'-73.95', u'40.77', u'-73.96', u'40.76'), 6.5777261123267685], [(u'-73.99', u'40.72', u'-74.00', u'40.73'), 7.174947356439588], [(u'-73.96', u'40.76', u'-73.96', u'40.76'), 5.536250903210267], [(u'-73.98', u'40.77', u'-73.98', u'40.76'), 6.074251873338167], [(u'-73.99', u'40.75', u'-73.98', u'40.75'), 6.627386670175669], [(u'-73.98', u'40.74', u'-73.97', u'40.75'), 6.603307586498783], [(u'-73.99', u'40.74', u'-74.00', u'40.74'), 5.757457386363637], [(u'-73.98', u'40.73', u'-73.99', u'40.74'), 7.404349800676187], [(u'-73.98', u'40.75', u'-73.98', u'40.75'), 6.32143075418653], [(u'-73.98', u'40.74', u'-73.98', u'40.73'), 6.008663825055597], [(u'-73.98', u'40.76', u'-73.98', u'40.75'), 6.432432895097234], [(u'-73.97', u'40.76', u'-73.96', u'40.77'), 6.481469152241456], [(u'-73.98', u'40.75', u'-73.99', u'40.74'), 6.60500341261091], [(u'-73.99', u'40.74', u'-73.99', u'40.75'), 6.41114121772394], [(u'-73.97', u'40.74', u'-73.98', u'40.73'), 6.004603310358706], [(u'-73.97', u'40.75', u'-73.99', u'40.75'), 8.165877178142447], [(u'-74.00', u'40.73', u'-73.99', u'40.72'), 7.398544125913435], [(u'-73.96', u'40.77', u'-73.97', u'40.76'), 7.001998212125993], [(u'-73.98', u'40.74', u'-73.98', u'40.74'), 5.980254455413287], [(u'-73.95', u'40.76', u'-73.95', u'40.77'), 5.464365383515415], [(u'-73.99', u'40.74', u'-73.98', u'40.74'), 5.858944998874466], [(u'-73.99', u'40.75', u'-73.98', u'40.76'), 6.673741106055517], [(u'-73.98', u'40.73', u'-73.98', u'40.74'), 6.359991990388466], [(u'-73.95', u'40.78', u'-73.96', u'40.76'), 8.204021663977874], [(u'-73.99', u'40.74', u'-74.00', u'40.73'), 6.272750205930807], [(u'', u'', u'', u''), 13.049632081496595], [(u'-73.98', u'40.76', u'-73.98', u'40.76'), 6.049877034984412]]

    for trip in data:
        geo = map(float,trip[0])
        print get_price(geo[1],geo[0],geo[3],geo[2]),trip[1]
        #print get_price(40.757977,-73.978165,40.751171,-73.989838)
